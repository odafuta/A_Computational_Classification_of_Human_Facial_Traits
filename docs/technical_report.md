# 動物分類器による人間の顔の特徴に対する分類技術レポート
## A Computational Classification of Human Facial Traits

**日付**: 2025年7月12日  
**プロジェクト**: 動物顔特徴分類システム

---

## 1. データ収集方法と前処理方法

### 1.1 データ収集方法

#### 1.1.1 動物画像データセット
- **データソース**: Kaggle Animal Faces Dataset (`andrewmvd/animal-faces`)
- **収集方法**: Kaggle APIコマンドを使用
  ```bash
  pip install kaggle
  kaggle datasets download -d andrewmvd/animal-faces
  unzip animal-faces.zip -d data/kaggle_raw/
  ```
- **データ構造**: 
  - Cat（猫）: 5,153枚
  - Dog（犬）: 4,739枚  
  - Wild（野生動物）: 4,738枚
- **合計**: 14,630枚の動物画像（訓練用）

#### 1.1.2 人間-動物ハイブリッド画像
- **生成方法**: AI画像生成サービス（Pollinations.ai API, Imagine4, ChatGPT）
- **生成数**: 30枚（各動物タイプ10枚ずつ）
- **ファイル命名規則**: `{animal_name}_human_{number}.jpg`
  - 例: `cat_human_01.jpg`, `dog_human_05.jpg`, `wild_human_03.jpg`
- **実装**: `scripts/generate_human_animal_images.py`で自動生成, ブラウザで手動生成
- **特徴**: 現実とアニメ風での動物的特徴を持つ人間の顔画像

### 1.2 前処理方法

#### 1.2.1 画像前処理パイプライン
1. **画像読み込み**: OpenCV (`cv2.imread()`)
2. **色空間変換**: BGR → RGB → グレースケール
3. **サイズ統一**: 128×128ピクセルにリサイズ
4. **切り取り処理**: **実施せず** - 全画像を128×128に統一リサイズのみ
5. **フラット化**: 16,384次元ベクトルに変換
6. **正規化**: 0-1範囲への正規化

#### 1.2.2 前処理パラメータ
- **入力画像サイズ**: 128×128ピクセル
- **特徴ベクトル長**: 16,384次元
- **データ分割**: 訓練80% (11,704枚) / テスト20% (2,926枚)

---

## 2. PCA（主成分分析）の実装

### 2.1 使用ライブラリ
- **scikit-learn**: `sklearn.decomposition.PCA`
- **機能**: 主成分分析による次元削減
- **実装コード**:
  ```python
  from sklearn.decomposition import PCA
  pca = PCA(n_components=110)
  X_pca = pca.fit_transform(X)
  ```

### 2.2 ハイパーパラメータとその影響

#### 2.2.1 主成分数の決定
- **選択した成分数**: 110成分
- **決定根拠**: 80%以上の情報保持を目標
- **実際の寄与率**: **80.89%**
- **圧縮率**: 16,384 → 110 (約149倍の圧縮)

#### 2.2.2 成分数の影響
- **少なすぎる場合**: 情報損失が大きく、分類精度が低下
- **多すぎる場合**: ノイズを含み、過学習のリスク
- **最適値**: 80-90%の寄与率を保持する成分数

---

## 3. SVM（サポートベクターマシン）の実装

### 3.1 使用ライブラリ
- **scikit-learn**: `sklearn.svm.SVC`
- **グリッドサーチ**: `sklearn.model_selection.GridSearchCV`
- **前処理**: `sklearn.preprocessing.StandardScaler`

### 3.2 ハイパーパラメータとその影響

#### 3.2.1 最適化されたパラメータ
```python
best_params = {
    'C': 10,           # 正則化パラメータ
    'gamma': 'scale',  # RBFカーネルパラメータ
    'kernel': 'rbf'    # 放射基底関数カーネル
}
```

#### 3.2.2 グリッドサーチ範囲
```python
param_grid = {
    'C': [0.1, 1, 10, 100],  # 正則化パラメータ
    'gamma': ['scale', 'auto', 0.001, 0.01, 0.1, 1],  # RBFカーネルパラメータ
    'kernel': ['rbf', 'poly', 'sigmoid']  # カーネル関数
}
```

#### 3.2.3 パラメータの影響
- **C値**: 正則化強度
  - 高い値: 複雑な決定境界、過学習のリスク
  - 低い値: 単純な決定境界、汎化性能向上
- **gamma値**: RBFカーネルの影響範囲
  - 高い値: 局所的な決定境界、過学習のリスク
  - 低い値: 滑らかな決定境界、汎化性能向上
- **kernel種類**: 
  - RBF: 非線形分離に適している
  - Poly: 多項式による非線形分離
  - Sigmoid: ニューラルネットワーク類似

---

## 4. 実験2で用いる動物ライクな人の顔画像

### 4.1 収集とラベル付け方法

#### 4.1.1 AI生成による画像収集
- **生成ツール**: Pollinations.ai API、Imagine4、ChatGPT
- **生成方法**: テキストプロンプトによる画像生成
- **選択基準**: 現実的・アニメ風で、動物過ぎず人間過ぎない適度な動物的特徴

#### 4.1.2 ラベル付け方法
- **アプローチ**: 生成時のファイル名によるラベル
- **命名規則**: `{animal_name}_human_{number}.jpg`
- **3クラス分類**: cat-like, dog-like, wild-like
- **クラスマッピング**: `{'cat': 0, 'dog': 1, 'wild': 2}`

### 4.2 具体的な生成例

#### 4.2.1 生成画像の分布
- **Cat-like**: 10枚（cat_human_01.jpg ～ cat_human_10.jpg）
- **Dog-like**: 10枚（dog_human_01.jpg ～ dog_human_10.jpg）
- **Wild-like**: 10枚（wild_human_01.jpg ～ wild_human_10.jpg）

#### 4.2.2 生成プロンプトの例
```
Cat-like humans:
- "Color image of a human face with a slight cat-like appearance."
- "Color image of a human face with a slight cat-like appearance like anime."

Dog-like humans:
- "Color image of a human face with a slight dog-like appearance."
- "Color image of a human face with a slight dog-like appearance like anime."

Wild animal-like humans:
- "Color image of a human face with a slight tiger-like appearance."
- "Color image of a human face with a slight tiger-like appearance like anime."
```

---

## 5. 実験結果

### 5.1 モデル評価：PCAの可視化

#### 5.1.1 主成分分析結果
- **元次元**: 16,384次元
- **削減次元**: 110次元
- **寄与率**: **80.89%**
- **圧縮率**: 約149倍

#### 5.1.2 固有顔(Eigenfaces)の可視化
- **保存場所**: `results/20250712_000423/eigenfaces.png`
- **内容**: 上位6つの主成分を画像として表示
- **解釈**: 各固有顔は異なる顔の特徴（輪郭、目、鼻、口など）を強調
- **特徴**: PCAの固有ベクトルをグレースケール画像として可視化

#### 5.1.3 寄与率プロット
- **累積寄与率**: 生成数に対する累積寄与率の推移
- **個別寄与率**: 上位20成分の個別寄与率
- **保存場所**: `results/20250712_000423/pca_analysis.png`

#### 5.1.4 2D散布図
- **保存場所**: `results/20250712_000423/pca_2d_visualization.png`
- **内容**: 第1・第2主成分での各クラスの分布
- **色分け**: 3クラス（cat, dog, wild）ごとに異なる色（赤、緑、青）
- **観察**: クラス間の分離性と重複領域の可視化

### 5.2 モデル評価：SVM分類結果

#### 5.2.1 動物画像分類結果
- **全体精度**: **87.29%**
- **交差検証精度**: **86.61%**
- **混同行列**: `results/20250712_000423/confusion_matrix.png`

#### 5.2.2 SVM決定境界可視化
- **保存場所**: `svm_boundary_visualization/svm_decision_boundary.png`
- **実装方法**: 2D PCA空間での決定境界の可視化
- **可視化内容**: 
  - 3クラス（cat, dog, wild）の決定境界領域を色分け表示
  - 各データポイントを色別（赤：cat、緑：dog、青：wild）で散布図表示
  - 決定境界の形状により、SVMの非線形分離能力を確認
- **技術的詳細**: 
  - 2D PCA変換後の特徴空間で境界を計算
  - StandardScalerによる特徴量正規化
  - RBFカーネルによる非線形決定境界
- **観察結果**: 
  - 各クラスが明確に分離される領域を確認
  - 境界付近での分類の不確実性を可視化
  - 3クラス分類における複雑な決定境界の形状

### 5.3 実験1：各動物クラスごとの精度

#### 5.3.1 クラス別性能
```python
classification_results = {
    'cat': {
        'precision': 0.88, 'recall': 0.88, 'f1_score': 0.88,
        'support': 1030
    },
    'dog': {
        'precision': 0.86, 'recall': 0.90, 'f1_score': 0.88,
        'support': 948
    },
    'wild': {
        'precision': 0.88, 'recall': 0.84, 'f1_score': 0.86,
        'support': 948
    }
}
```

#### 5.3.2 混同行列
- **保存場所**: `results/20250712_000423/confusion_matrix.png`
- **全体精度**: **87.29%**

### 5.4 実験2：人間画像の動物分類結果

#### 5.4.1 分類結果概要
- **全体精度**: **36.67%** (11/30枚正解)
- **Dog-like偏重**: 76.7%の画像がdog-likeと分類
- **Cat-like検出困難**: 生成時ラベルのcat-like画像は全て誤分類（0%正解）

#### 5.4.2 詳細分類結果
- **Cat-like画像（10枚）**:
   - 正解: 0枚 (0%)
   - 全てdog-likeと誤分類

- **Dog-like画像（10枚）**:
   - 正解: 9枚 (90%)
   - 最も高い精度

- **Wild-like画像（10枚）**:
   - 正解: 2枚 (20%)
   - 多くがdog-likeまたはcat-likeと誤分類

#### 5.4.3 共通する特徴
- **Dog-like分類の共通点**: 人間の表情筋がdog-like特徴と類似
- **誤分類の傾向**: AI生成画像の特徴が実際の人間の顔と異なる可能性

### 5.5 実験3：モデルの総合評価

#### 5.5.1 総合性能
- **動物分類**: 87.29%の高精度
- **人間分類**: 36.67%の精度（課題あり）
- **主要課題**: ドメイン適応の困難性とdog-like特徴への偏重

#### 5.5.2 発見された知見
- **特徴空間の違い**: 動物と人間の顔の特徴空間が大きく異なる
- **転移学習の限界**: 動物で訓練されたモデルの人間への適用困難
- **Dog-like特徴の汎用性**: 人間の表情筋がdog-like特徴と最も類似

---

## 6. 結論

### 6.1 技術的成果
- **高精度動物分類システム**: 87.29%の精度を達成
- **効果的な次元削減**: 149倍圧縮で80.89%の情報保持
- **大規模データ処理**: 14,630枚の画像を成功裏に処理
- **完全な可視化システム**: 固有顔、PCA散布図、SVM決定境界の実装、混同行列

### 6.2 発見された課題
- **ドメイン適応の困難性**: 動物→人間への特徴転移が困難
- **分類偏重問題**: Dog-like特徴への強い偏り
- **AI生成画像の限界**: 実際の人間の顔との特徴差

### 6.3 今後の改善方向
- **ドメイン適応手法**: 動物と人間の特徴空間を橋渡し
- **実写人間画像**: AI生成ではなく実際の人間の顔画像
- **専門家ラベリング**: 動物的特徴の客観的評価
- **データ拡張**: より多様な人間の顔画像の収集

---

## 7. 技術的成果

### 7.1 システム実装 ✅
- **完全実装**: 3クラス動物分類システム（87.29%精度）
- **大規模データ処理**: 14,630枚の画像処理
- **最適化**: グリッドサーチによるハイパーパラメータ最適化
- **可視化**: 固有顔、混同行列、PCA散布図、SVM決定境界の生成

---

**最終更新**: 2025年7月12日  
**動物分類精度**: 87.29%  
**人間分類精度**: 36.67%  
**データセット**: 14,630枚（3クラス動物分類）  
**人間画像評価**: 30枚（100%処理成功、36.67%分類精度）  
**技術スタック**: Python, scikit-learn, OpenCV, Kaggle API, AI画像生成サービス API  
**主要発見**: Dog-like特徴への偏重（76.7%）、Cat-like特徴検出困難（0%精度） 